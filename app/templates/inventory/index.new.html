{% extends "base.html" %}

{% block title %}자산 실사 - 자산관리 시스템{% endblock %}

{% block page_header %}
<div class="page__header">
    <div>
        <h2 class="page__title">자산 실사</h2>
        <p class="page__subtitle">자산 실사 관리 및 진행 현황</p>
    </div>
    <div class="page__actions">
        <a href="{{ url_for('inventory.create') }}" class="btn btn-primary">
            <i class="fas fa-plus"></i> 실사 등록
        </a>
    </div>
</div>
{% endblock %}

{% block content %}
<!-- 새로운 매크로 시스템 사용 -->
{% from 'macros/cards.html' import stat_card %}
{% from 'macros/tables.html' import data_table %}
{% from 'macros/buttons.html' import btn, btn_group %}

<div class="list-layout">
    <!-- 통계 카드 섹션 -->
    <div class="summary-cards">
        {{ stat_card(
            title='진행중인 실사',
            value=status_counts.in_progress,
            icon='fa-clipboard-list',
            color='primary',
            trend='+2건 (이번주)'
        ) }}
        
        {{ stat_card(
            title='완료된 실사',
            value=status_counts.completed,
            icon='fa-check-circle',
            color='success',
            trend='+5건 (이번달)'
        ) }}
        
        {{ stat_card(
            title='예정된 실사',
            value=status_counts.planned,
            icon='fa-calendar',
            color='warning',
            trend='3건 (다음주)'
        ) }}
    </div>

    <!-- 콘텐츠 섹션 -->
    <div class="content-section">
        <div class="content-section__header">
            <h3 class="content-section__title">실사 목록</h3>
            <div class="content-section__actions">
                {{ btn('엑셀 내보내기', variant='outline-primary', icon='fa-file-excel', id='btnExportExcel') }}
                {{ btn('불일치 항목', variant='outline-danger', icon='fa-exclamation-triangle', url=url_for('inventory.discrepancies')) }}
                {{ btn('실사 이력', variant='outline-secondary', icon='fa-history', url=url_for('inventory.history')) }}
            </div>
        </div>
        
        <div class="content-section__body content-section--flush">
            {% if inventories %}
                {% set headers = [
                    {'label': '실사 번호', 'sortable': true},
                    {'label': '실사명', 'sortable': true},
                    {'label': '실사 기간'},
                    {'label': '대상 자산'},
                    {'label': '담당자'},
                    {'label': '진행 상태', 'class': 'table__cell--center'},
                    {'label': '처리', 'class': 'table__cell--center'}
                ] %}
                
                {% set rows = [] %}
                {% for inventory in inventories %}
                    {% set progress_percent = (inventory.completed_count / inventory.target_count * 100)|int if inventory.target_count > 0 else 0 %}
                    
                    {% set progress_bar = '<div class="progress-indicator">' +
                        '<div class="progress-indicator__label">' + inventory.completed_count|string + '/' + inventory.target_count|string + '</div>' +
                        '<div class="progress-indicator__bar" style="width: ' + progress_percent|string + '%"></div>' +
                        '</div>' %}
                    
                    {% set status_badge = {
                        'planned': '<span class="status-badge status-badge--warning">예정됨</span>',
                        'in_progress': '<span class="status-badge status-badge--primary">진행중</span>',
                        'completed': '<span class="status-badge status-badge--success">완료됨</span>'
                    }.get(inventory.status, '<span class="status-badge status-badge--inactive">알 수 없음</span>') %}
                    
                    {% set action_dropdown = '<div class="dropdown">' +
                        '<button class="btn btn-sm btn-outline-secondary dropdown-toggle" type="button" data-bs-toggle="dropdown">' +
                        '<i class="fas fa-ellipsis-v"></i>' +
                        '</button>' +
                        '<div class="dropdown-menu">' +
                        '<a class="dropdown-item" href="' + url_for('inventory.detail', inventory_id=inventory.id) + '">' +
                        '<i class="fas fa-eye"></i> 상세보기</a>' +
                        '<a class="dropdown-item" href="' + url_for('inventory.edit', inventory_id=inventory.id) + '">' +
                        '<i class="fas fa-edit"></i> 수정</a>' +
                        '<a class="dropdown-item" href="' + url_for('inventory.report', inventory_id=inventory.id) + '">' +
                        '<i class="fas fa-file-alt"></i> 보고서</a>' +
                        '<div class="dropdown-divider"></div>' +
                        '<a class="dropdown-item text-danger" href="#" onclick="return confirm(\'정말로 삭제하시겠습니까?\')">' +
                        '<i class="fas fa-trash-alt"></i> 삭제</a>' +
                        '</div>' +
                        '</div>' %}
                    
                    {% set _ = rows.append([
                        inventory.id,
                        '<a href="' + url_for('inventory.detail', inventory_id=inventory.id) + '" class="text-decoration-none">' + inventory.name + '</a>',
                        inventory.start_date + ' ~ ' + inventory.end_date,
                        progress_bar,
                        inventory.manager + ' (' + inventory.department + ')',
                        status_badge,
                        action_dropdown
                    ]) %}
                {% endfor %}
                
                {{ data_table(
                    headers=headers,
                    rows=rows,
                    variant='hover',
                    responsive=true
                ) }}
            {% else %}
                <div class="empty-state">
                    <div class="empty-state__icon">
                        <i class="fas fa-clipboard-list"></i>
                    </div>
                    <div class="empty-state__title">등록된 실사 정보가 없습니다</div>
                    <div class="empty-state__description">새로운 자산 실사를 등록해보세요.</div>
                    <div class="empty-state__action">
                        {{ btn('실사 등록', variant='primary', icon='fa-plus', url=url_for('inventory.create')) }}
                    </div>
                </div>
            {% endif %}
        </div>
    </div>
    
    <!-- 최근 활동 타임라인 -->
    <div class="content-section">
        <div class="content-section__header">
            <h3 class="content-section__title">최근 실사 활동</h3>
        </div>
        <div class="content-section__body">
            <div class="activity-timeline">
                <div class="activity-item">
                    <div class="activity-item__content">
                        <div class="activity-item__header">
                            <div class="activity-item__title">2023년 3분기 정기 실사 완료</div>
                            <div class="activity-item__time">오늘</div>
                        </div>
                        <div class="activity-item__description">
                            전사 자산 실사 완료 (98% 일치율)<br>
                            <small>담당자: 김실사</small>
                        </div>
                    </div>
                </div>
                
                <div class="activity-item">
                    <div class="activity-item__content">
                        <div class="activity-item__header">
                            <div class="activity-item__title">IT 장비 부분 실사 시작</div>
                            <div class="activity-item__time">어제</div>
                        </div>
                        <div class="activity-item__description">
                            서버실 및 네트워크 장비 실사 진행중<br>
                            <small>담당자: 이점검</small>
                        </div>
                    </div>
                </div>
                
                <div class="activity-item">
                    <div class="activity-item__content">
                        <div class="activity-item__header">
                            <div class="activity-item__title">실사 불일치 항목 발견</div>
                            <div class="activity-item__time">2일 전</div>
                        </div>
                        <div class="activity-item__description">
                            노트북 3대 위치 불일치<br>
                            <small>담당자: 박확인</small>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block styles %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/pages/inventory/index.new.css') }}">
{% endblock %}

{% block scripts %}
<script src="{{ url_for('static', filename='js/pages/inventory/index.js') }}" type="module"></script>
{% endblock %}