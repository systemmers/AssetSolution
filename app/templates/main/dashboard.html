{% extends "base.html" %}

{% block title %}대시보드 - 자산관리 시스템{% endblock %}

{% block page_header %}
<div class="d-flex justify-content-between align-items-center mb-4">
    <h1 class="h2 mb-0 text-gray-800">
        <i class="fas fa-tachometer-alt me-2 text-primary"></i>대시보드
    </h1>
    <div>
        <span class="text-muted">기준일: <strong class="text-dark">{{ current_date }}</strong></span>
    </div>
</div>
{% endblock %}

{% block content %}
<!-- 자산 상태 요약 카드 -->
<div class="row g-4 mb-4">
    <div class="col-xl-3 col-md-6">
        <div class="card border-0 shadow-sm h-100 bg-gradient-primary text-white">
            <div class="card-body p-4">
                <div class="d-flex justify-content-between align-items-center">
                    <div>
                        <div class="text-white-50 small">총 자산</div>
                        <div class="h2 mb-0 fw-bold">{{ total_assets }}</div>
                    </div>
                    <div class="flex-shrink-0">
                        <i class="fas fa-boxes fa-2x text-white-50"></i>
                </div>
                </div>
            </div>
        </div>
    </div>

    <div class="col-xl-3 col-md-6">
        <div class="card border-0 shadow-sm h-100 bg-gradient-success text-white">
            <div class="card-body p-4">
                <div class="d-flex justify-content-between align-items-center">
                    <div>
                        <div class="text-white-50 small">정상 자산</div>
                        <div class="h2 mb-0 fw-bold">{{ normal_assets }}</div>
                    </div>
                    <div class="flex-shrink-0">
                        <i class="fas fa-check-circle fa-2x text-white-50"></i>
                </div>
                </div>
            </div>
        </div>
    </div>

    <div class="col-xl-3 col-md-6">
        <div class="card border-0 shadow-sm h-100 bg-gradient-warning text-white">
            <div class="card-body p-4">
                <div class="d-flex justify-content-between align-items-center">
                    <div>
                        <div class="text-white-50 small">수리중</div>
                        <div class="h2 mb-0 fw-bold">{{ maintenance_assets }}</div>
                    </div>
                    <div class="flex-shrink-0">
                        <i class="fas fa-tools fa-2x text-white-50"></i>
                </div>
                </div>
            </div>
        </div>
    </div>

    <div class="col-xl-3 col-md-6">
        <div class="card border-0 shadow-sm h-100 bg-gradient-danger text-white">
            <div class="card-body p-4">
                <div class="d-flex justify-content-between align-items-center">
                    <div>
                        <div class="text-white-50 small">폐기 예정</div>
                        <div class="h2 mb-0 fw-bold">{{ disposed_assets }}</div>
                    </div>
                    <div class="flex-shrink-0">
                        <i class="fas fa-trash-alt fa-2x text-white-50"></i>
                </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- 계약 요약 카드 -->
<div class="row g-4 mb-4">
    <div class="col-xl-3 col-md-6">
        <div class="card border-start-primary shadow-sm h-100">
            <div class="card-body p-4">
                <div class="d-flex justify-content-between align-items-center">
                    <div>
                        <div class="text-muted small">총 계약</div>
                        <div class="h3 mb-0 fw-bold text-gray-800">{{ total_contracts }}</div>
                    </div>
                    <div class="flex-shrink-0">
                        <i class="fas fa-file-contract fa-2x text-primary"></i>
                </div>
                </div>
            </div>
        </div>
    </div>

    <div class="col-xl-3 col-md-6">
        <div class="card border-start-success shadow-sm h-100">
            <div class="card-body p-4">
                <div class="d-flex justify-content-between align-items-center">
                    <div>
                        <div class="text-muted small">진행중 계약</div>
                        <div class="h3 mb-0 fw-bold text-gray-800">{{ active_contracts }}</div>
                    </div>
                    <div class="flex-shrink-0">
                        <i class="fas fa-clipboard-check fa-2x text-success"></i>
                </div>
                </div>
            </div>
        </div>
    </div>

    <div class="col-xl-3 col-md-6">
        <div class="card border-start-warning shadow-sm h-100">
            <div class="card-body p-4">
                <div class="d-flex justify-content-between align-items-center">
                    <div>
                        <div class="text-muted small">만료 임박</div>
                        <div class="h3 mb-0 fw-bold text-gray-800">{{ expiring_contracts }}</div>
                    </div>
                    <div class="flex-shrink-0">
                        <i class="fas fa-exclamation-triangle fa-2x text-warning"></i>
                </div>
                </div>
            </div>
        </div>
    </div>

    <div class="col-xl-3 col-md-6">
        <div class="card border-start-info shadow-sm h-100">
            <div class="card-body p-4">
                <div class="d-flex justify-content-between align-items-center">
                    <div>
                        <div class="text-muted small">월간 계약비용</div>
                        <div class="h4 mb-0 fw-bold text-gray-800">₩ {{ '{:,.0f}'.format(monthly_cost) }}</div>
                    </div>
                    <div class="flex-shrink-0">
                        <i class="fas fa-won-sign fa-2x text-info"></i>
                </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- 메인 콘텐츠 섹션 -->
<div class="row g-4">
    <!-- 왼쪽 콘텐츠 영역 -->
    <div class="col-lg-8">
        <!-- 최근 등록 자산 -->
        <div class="card shadow-sm border-0 mb-4">
            <div class="card-header bg-light border-bottom py-3">
                <div class="d-flex justify-content-between align-items-center">
                    <h6 class="mb-0 fw-semibold text-gray-800">
                        <i class="fas fa-plus-circle me-2 text-primary"></i>최근 등록 자산
                    </h6>
                    <a href="{{ url_for('assets.index') }}" class="btn btn-primary btn-sm">
                        <i class="fas fa-eye me-1"></i>전체보기
                    </a>
                </div>
            </div>
            <div class="card-body p-0">
                <div class="table-responsive">
                    <table class="table table-hover table-striped mb-0">
                        <thead class="table-light">
                            <tr>
                                <th class="fw-semibold">자산번호</th>
                                <th class="fw-semibold">자산명</th>
                                <th class="fw-semibold">카테고리</th>
                                <th class="fw-semibold">위치</th>
                                <th class="fw-semibold">상태</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for asset in recent_assets %}
                            <tr>
                                <td class="fw-medium">{{ asset.asset_number }}</td>
                                <td>{{ asset.name }}</td>
                                <td>
                                    <span class="badge bg-light text-dark border">
                                    {% if asset.category_id == 1 %}
                                        <i class="fas fa-laptop me-1"></i>노트북
                                    {% elif asset.category_id == 2 %}
                                        <i class="fas fa-desktop me-1"></i>데스크탑
                                    {% elif asset.category_id == 3 %}
                                        <i class="fas fa-tv me-1"></i>모니터
                                    {% elif asset.category_id == 4 %}
                                        <i class="fas fa-server me-1"></i>서버
                                    {% elif asset.category_id == 5 %}
                                        <i class="fas fa-network-wired me-1"></i>네트워크 장비
                                    {% elif asset.category_id == 6 %}
                                        <i class="fas fa-mouse me-1"></i>주변기기
                                    {% elif asset.category_id == 7 %}
                                        <i class="fas fa-code me-1"></i>소프트웨어
                                    {% else %}
                                        <i class="fas fa-cube me-1"></i>기타
                                    {% endif %}
                                    </span>
                                </td>
                                <td class="text-muted">{{ asset.location_name }}</td>
                                <td>
                                    {% if asset.status == 'available' %}
                                    <span class="badge bg-success"><i class="fas fa-check me-1"></i>사용가능</span>
                                    {% elif asset.status == 'in_use' %}
                                    <span class="badge bg-primary"><i class="fas fa-user me-1"></i>사용중</span>
                                    {% elif asset.status == 'in_repair' %}
                                    <span class="badge bg-warning text-dark"><i class="fas fa-tools me-1"></i>수리중</span>
                                    {% elif asset.status == 'disposed' %}
                                    <span class="badge bg-danger"><i class="fas fa-trash me-1"></i>폐기</span>
                                    {% elif asset.status == 'reserved' %}
                                    <span class="badge bg-info"><i class="fas fa-clock me-1"></i>예약됨</span>
                                    {% else %}
                                    <span class="badge bg-secondary">기타</span>
                                    {% endif %}
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
        
        <!-- 최근 활동 카드 -->
        <div class="card shadow-sm border-0 mb-4">
            <div class="card-header bg-light border-bottom py-3">
                <h6 class="mb-0 fw-semibold text-gray-800">
                    <i class="fas fa-history me-2 text-primary"></i>최근 활동
                </h6>
            </div>
            <div class="card-body p-4">
                <div class="timeline">
                    <div class="timeline-item">
                        <div class="timeline-time text-muted small">오늘</div>
                        <div class="timeline-content">
                            <div class="fw-semibold text-gray-800">자산 상태 변경</div>
                            <p class="mb-2 text-gray-600">노트북 HP EliteBook 850 G7 - 사용중 → 수리중</p>
                            <small class="text-muted">
                                <i class="fas fa-user me-1"></i>담당자: 김관리
                            </small>
                        </div>
                    </div>
                    
                    <div class="timeline-item">
                        <div class="timeline-time text-muted small">어제</div>
                        <div class="timeline-content">
                            <div class="fw-semibold text-gray-800">자산 등록</div>
                            <p class="mb-2 text-gray-600">모니터 Dell P2720D 외 2종</p>
                            <small class="text-muted">
                                <i class="fas fa-user me-1"></i>담당자: 이등록
                            </small>
                        </div>
                    </div>
                    
                    <div class="timeline-item">
                        <div class="timeline-time text-muted small">2일 전</div>
                        <div class="timeline-content">
                            <div class="fw-semibold text-gray-800">계약 갱신</div>
                            <p class="mb-2 text-gray-600">Microsoft Office 365 라이선스</p>
                            <small class="text-muted">
                                <i class="fas fa-user me-1"></i>담당자: 박계약
                            </small>
                        </div>
                    </div>
                    
                    <div class="timeline-item">
                        <div class="timeline-time text-muted small">3일 전</div>
                        <div class="timeline-content">
                            <div class="fw-semibold text-gray-800">자산 반출</div>
                            <p class="mb-2 text-gray-600">노트북 HP EliteBook 840 G7 - 외근용</p>
                            <small class="text-muted">
                                <i class="fas fa-user me-1"></i>담당자: 최사용
                            </small>
                        </div>
                    </div>
                    
                    <div class="timeline-item">
                        <div class="timeline-time text-muted small">일주일 전</div>
                        <div class="timeline-content">
                            <div class="fw-semibold text-gray-800">자산 실사 완료</div>
                            <p class="mb-2 text-gray-600">1분기 정기 자산 실사</p>
                            <small class="text-muted">
                                <i class="fas fa-user me-1"></i>담당자: 김실사
                            </small>
                        </div>
                    </div>
                </div>
                
                <div class="text-center mt-4 pt-3 border-top">
                    <a href="#" class="btn btn-outline-primary btn-sm">
                        <i class="fas fa-list me-1"></i>모든 활동 보기
                    </a>
                </div>
            </div>
        </div>
        
        <!-- 만료 임박 계약 -->
        <div class="card shadow-sm border-0 mb-4">
            <div class="card-header bg-light border-bottom py-3">
                <div class="d-flex justify-content-between align-items-center">
                    <h6 class="mb-0 fw-semibold text-gray-800">
                        <i class="fas fa-exclamation-triangle me-2 text-warning"></i>만료 임박 계약
                    </h6>
                    <a href="{{ url_for('contract.index') }}" class="btn btn-warning btn-sm">
                        <i class="fas fa-eye me-1"></i>전체보기
                    </a>
                </div>
            </div>
            <div class="card-body p-0">
                {% if soon_expiring_contracts %}
                <div class="table-responsive">
                    <table class="table table-hover table-striped mb-0">
                        <thead class="table-light">
                            <tr>
                                <th class="fw-semibold">계약번호</th>
                                <th class="fw-semibold">계약명</th>
                                <th class="fw-semibold">공급업체</th>
                                <th class="fw-semibold">종료일</th>
                                <th class="fw-semibold">남은 기간</th>
                                <th class="fw-semibold">상태</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for contract in soon_expiring_contracts %}
                            <tr>
                                <td class="fw-medium">{{ contract.contract_no }}</td>
                                <td>{{ contract.name }}</td>
                                <td class="text-muted">{{ contract.vendor }}</td>
                                <td>{{ contract.end_date }}</td>
                                <td>
                                    <span class="badge bg-warning text-dark">
                                        <i class="fas fa-clock me-1"></i>{{ contract.days_remaining }}일
                                    </span>
                                </td>
                                <td>
                                    {% if contract.status == 'active' %}
                                    <span class="badge bg-success"><i class="fas fa-check me-1"></i>진행중</span>
                                    {% elif contract.status == 'expiring' %}
                                    <span class="badge bg-warning text-dark"><i class="fas fa-exclamation-triangle me-1"></i>만료예정</span>
                                    {% elif contract.status == 'expired' %}
                                    <span class="badge bg-danger"><i class="fas fa-times me-1"></i>만료됨</span>
                                    {% else %}
                                    <span class="badge bg-secondary">기타</span>
                                    {% endif %}
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
                {% else %}
                <!-- 샘플 데이터로 UI 채우기 -->
                <div class="table-responsive">
                    <table class="table table-hover table-striped mb-0">
                        <thead class="table-light">
                            <tr>
                                <th class="fw-semibold">계약번호</th>
                                <th class="fw-semibold">계약명</th>
                                <th class="fw-semibold">공급업체</th>
                                <th class="fw-semibold">종료일</th>
                                <th class="fw-semibold">남은 기간</th>
                                <th class="fw-semibold">상태</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td class="fw-medium">CONT-2023-0145</td>
                                <td>Microsoft Office 365 구독</td>
                                <td class="text-muted">Microsoft</td>
                                <td>2023-12-31</td>
                                <td><span class="badge bg-danger"><i class="fas fa-exclamation me-1"></i>7일</span></td>
                                <td><span class="badge bg-warning text-dark"><i class="fas fa-exclamation-triangle me-1"></i>만료예정</span></td>
                            </tr>
                            <tr>
                                <td class="fw-medium">CONT-2023-0192</td>
                                <td>Adobe Creative Cloud 라이선스</td>
                                <td class="text-muted">Adobe</td>
                                <td>2024-01-15</td>
                                <td><span class="badge bg-warning text-dark"><i class="fas fa-clock me-1"></i>22일</span></td>
                                <td><span class="badge bg-warning text-dark"><i class="fas fa-exclamation-triangle me-1"></i>만료예정</span></td>
                            </tr>
                            <tr>
                                <td class="fw-medium">CONT-2022-0087</td>
                                <td>서버실 유지보수 계약</td>
                                <td class="text-muted">한국IT서비스</td>
                                <td>2024-01-10</td>
                                <td><span class="badge bg-warning text-dark"><i class="fas fa-clock me-1"></i>17일</span></td>
                                <td><span class="badge bg-warning text-dark"><i class="fas fa-exclamation-triangle me-1"></i>만료예정</span></td>
                            </tr>
                            <tr>
                                <td class="fw-medium">CONT-2023-0203</td>
                                <td>보안 소프트웨어 라이선스</td>
                                <td class="text-muted">시큐어테크</td>
                                <td>2024-01-05</td>
                                <td><span class="badge bg-warning text-dark"><i class="fas fa-clock me-1"></i>12일</span></td>
                                <td><span class="badge bg-warning text-dark"><i class="fas fa-exclamation-triangle me-1"></i>만료예정</span></td>
                            </tr>
                            <tr>
                                <td class="fw-medium">CONT-2023-0134</td>
                                <td>네트워크 장비 유지보수</td>
                                <td class="text-muted">네트워크솔루션</td>
                                <td>2024-01-20</td>
                                <td><span class="badge bg-success"><i class="fas fa-check me-1"></i>27일</span></td>
                                <td><span class="badge bg-success"><i class="fas fa-check me-1"></i>진행중</span></td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                {% endif %}
            </div>
        </div>
    </div>

    <!-- 오른쪽 사이드 섹션 -->
    <div class="col-lg-4">
        <!-- 자산 카테고리 분포 -->
        <div class="card shadow-sm border-0 mb-4">
            <div class="card-header bg-light border-bottom py-3">
                <h6 class="mb-0 fw-semibold text-gray-800">
                    <i class="fas fa-chart-pie me-2 text-primary"></i>자산 카테고리 분포
                </h6>
            </div>
            <div class="card-body p-4">
                {% if category_stats %}
                <div class="chart-container mb-3">
                    <!-- 차트가 여기에 렌더링됩니다 -->
                    <canvas id="categoryChart" style="max-height: 300px;"></canvas>
                </div>
                <div class="row g-2">
                    {% for category, count in category_stats.items() %}
                    <div class="col-6">
                        <div class="d-flex align-items-center p-2 bg-light rounded">
                            <div class="flex-shrink-0">
                            {% if category == '노트북' %}
                                <i class="fas fa-laptop text-primary"></i>
                            {% elif category == '데스크탑' %}
                                <i class="fas fa-desktop text-info"></i>
                            {% elif category == '모니터' %}
                                <i class="fas fa-tv text-success"></i>
                            {% elif category == '서버' %}
                                <i class="fas fa-server text-danger"></i>
                            {% elif category == '네트워크 장비' %}
                                <i class="fas fa-network-wired text-warning"></i>
                            {% else %}
                                <i class="fas fa-cube text-secondary"></i>
                            {% endif %}
                            </div>
                            <div class="ms-2 flex-grow-1">
                                <div class="small text-muted">{{ category }}</div>
                                <div class="fw-semibold">{{ count }}개</div>
                            </div>
                        </div>
                    </div>
                    {% endfor %}
                </div>
                {% else %}
                <!-- 샘플 데이터 -->
                <div class="chart-container mb-3">
                    <canvas id="categoryChart" style="max-height: 300px;"></canvas>
                </div>
                <div class="row g-2">
                    <div class="col-6">
                        <div class="d-flex align-items-center p-2 bg-light rounded">
                            <div class="flex-shrink-0">
                                <i class="fas fa-laptop text-primary"></i>
                            </div>
                            <div class="ms-2 flex-grow-1">
                                <div class="small text-muted">노트북</div>
                                <div class="fw-semibold">45개</div>
                            </div>
            </div>
        </div>
                    <div class="col-6">
                        <div class="d-flex align-items-center p-2 bg-light rounded">
                            <div class="flex-shrink-0">
                                <i class="fas fa-desktop text-info"></i>
                            </div>
                            <div class="ms-2 flex-grow-1">
                                <div class="small text-muted">데스크탑</div>
                                <div class="fw-semibold">32개</div>
            </div>
                        </div>
                    </div>
                    <div class="col-6">
                        <div class="d-flex align-items-center p-2 bg-light rounded">
                            <div class="flex-shrink-0">
                                <i class="fas fa-tv text-success"></i>
                            </div>
                            <div class="ms-2 flex-grow-1">
                                <div class="small text-muted">모니터</div>
                                <div class="fw-semibold">67개</div>
                            </div>
                        </div>
                    </div>
                    <div class="col-6">
                        <div class="d-flex align-items-center p-2 bg-light rounded">
                            <div class="flex-shrink-0">
                                <i class="fas fa-server text-danger"></i>
                            </div>
                            <div class="ms-2 flex-grow-1">
                                <div class="small text-muted">서버</div>
                                <div class="fw-semibold">8개</div>
                            </div>
                        </div>
                </div>
                </div>
                {% endif %}
            </div>
        </div>

        <!-- 빠른 작업 메뉴 -->
        <div class="card shadow-sm border-0 mb-4">
            <div class="card-header bg-light border-bottom py-3">
                <h6 class="mb-0 fw-semibold text-gray-800">
                    <i class="fas fa-bolt me-2 text-primary"></i>빠른 작업
                </h6>
            </div>
            <div class="card-body p-3">
                <div class="d-grid gap-2">
                    <a href="{{ url_for('assets.create') }}" class="btn btn-outline-primary">
                        <i class="fas fa-plus me-2"></i>자산 등록
                    </a>
                    <a href="{{ url_for('contract.create') }}" class="btn btn-outline-success">
                        <i class="fas fa-file-contract me-2"></i>계약 등록
                    </a>
                    <a href="{{ url_for('inventory.create') }}" class="btn btn-outline-info">
                        <i class="fas fa-clipboard-list me-2"></i>실사 생성
                    </a>
                    <a href="{{ url_for('operations.index') }}" class="btn btn-outline-warning">
                        <i class="fas fa-exchange-alt me-2"></i>운영 관리
                    </a>
                </div>
            </div>
        </div>

        <!-- 시스템 상태 -->
        <div class="card shadow-sm border-0">
            <div class="card-header bg-light border-bottom py-3">
                <h6 class="mb-0 fw-semibold text-gray-800">
                    <i class="fas fa-info-circle me-2 text-primary"></i>시스템 상태
                </h6>
            </div>
            <div class="card-body p-3">
                <div class="d-flex align-items-center justify-content-between mb-3">
                    <span class="text-muted small">서비스 상태</span>
                    <span class="badge bg-success"><i class="fas fa-check me-1"></i>정상</span>
                </div>
                <div class="d-flex align-items-center justify-content-between mb-3">
                    <span class="text-muted small">데이터베이스</span>
                    <span class="badge bg-success"><i class="fas fa-check me-1"></i>연결됨</span>
                </div>
                <div class="d-flex align-items-center justify-content-between mb-3">
                    <span class="text-muted small">백업 상태</span>
                    <span class="badge bg-info"><i class="fas fa-clock me-1"></i>최근 1시간</span>
                </div>
                <div class="d-flex align-items-center justify-content-between">
                    <span class="text-muted small">버전</span>
                    <span class="badge bg-light text-dark border">v1.0.0</span>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- 차트 초기화 스크립트 -->
<script>
document.addEventListener('DOMContentLoaded', function() {
    // 카테고리 분포 차트
    const ctx = document.getElementById('categoryChart');
    if (ctx) {
        new Chart(ctx, {
            type: 'doughnut',
            data: {
                labels: ['노트북', '데스크탑', '모니터', '서버', '네트워크 장비', '기타'],
                datasets: [{
                    data: [45, 32, 67, 8, 15, 23],
                    backgroundColor: [
                        '#0d6efd',
                        '#0dcaf0',
                        '#198754',
                        '#dc3545',
                        '#fd7e14',
                        '#6c757d'
                    ],
                    borderWidth: 0
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        display: false
                    }
                }
            }
        });
    }
});
</script>
{% endblock %} 
