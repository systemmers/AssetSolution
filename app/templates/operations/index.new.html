{% extends "base.html" %}

{% block title %}운영 관리 - 자산관리 시스템{% endblock %}

{% block page_header %}
<div class="page__header">
    <div>
        <h2 class="page__title">자산 운영 관리</h2>
        <p class="page__subtitle">자산의 대여, 반납, 폐기 등 운영 업무 통합 관리</p>
    </div>
</div>
{% endblock %}

{% block content %}
<!-- 새로운 매크로 시스템 사용 -->
{% from 'macros/cards.html' import stat_card, operations_card, summary_stats %}
{% from 'macros/buttons.html' import btn %}

<div class="dashboard-layout">
    <!-- 운영 통계 카드 섹션 -->
    <div class="dashboard-layout__stats">
        <div class="summary-cards">
            {{ stat_card(
                title='현재 대여 중',
                value=28,
                icon='fa-exchange-alt',
                color='primary',
                trend='+3건 (이번주)',
                link_url=url_for('operations.loan_index') + '?status=대여중',
                link_text='자세히 보기'
            ) }}
            
            {{ stat_card(
                title='오늘 반납 예정',
                value=3,
                icon='fa-clock',
                color='success',
                trend='정시 반납률 95%',
                link_url=url_for('operations.loan_index') + '?due=today',
                link_text='자세히 보기'
            ) }}
            
            {{ stat_card(
                title='반납 지연',
                value=5,
                icon='fa-exclamation-triangle',
                color='warning',
                trend='-2건 (지난주 대비)',
                link_url=url_for('operations.loan_index') + '?status=overdue',
                link_text='자세히 보기'
            ) }}
            
            {{ stat_card(
                title='폐기 승인 대기',
                value=2,
                icon='fa-trash-alt',
                color='danger',
                trend='평균 승인시간 3일',
                link_url=url_for('operations.disposal_index') + '?status=pending',
                link_text='자세히 보기'
            ) }}
        </div>
    </div>

    <!-- 메인 콘텐츠 영역 -->
    <div class="dashboard-layout__main">
        <div class="dashboard-layout__primary">
            <!-- 핵심 운영 기능 -->
            <div class="content-section">
                <div class="content-section__header">
                    <h3 class="content-section__title">핵심 운영 기능</h3>
                </div>
                <div class="content-section__body">
                    <div class="quick-actions">
                        <div class="quick-actions__grid">
                            {{ operations_card(
                                title='자산 대여 관리',
                                description='자산의 대여 신청, 승인, 사용 현황 관리 및 모니터링',
                                icon='fa-handshake',
                                color='primary',
                                actions=[
                                    {'label': '대여 현황', 'url': url_for('operations.loan_index')},
                                    {'label': '대여 신청/등록', 'url': url_for('operations.loan_form')}
                                ],
                                primary_action={'label': '새 대여 등록', 'url': url_for('operations.loan_form'), 'icon': 'fa-plus'}
                            ) }}
                            
                            {{ operations_card(
                                title='자산 반납 관리',
                                description='자산의 반납 처리, 승인 워크플로우 및 이력 관리',
                                icon='fa-undo',
                                color='success',
                                actions=[
                                    {'label': '승인 워크플로우', 'url': url_for('operations.return_approval_workflow'), 'icon': 'fa-tasks'},
                                    {'label': '상태 추적', 'url': url_for('operations.return_status_tracking'), 'icon': 'fa-chart-line'},
                                    {'label': '알림 관리', 'url': url_for('operations.return_notifications'), 'icon': 'fa-bell'},
                                    {'label': '반납 이력', 'url': url_for('operations.return_history')},
                                    {'label': '반납 처리', 'url': url_for('operations.return_form')}
                                ],
                                primary_action={'label': '반납 처리', 'url': url_for('operations.return_form'), 'icon': 'fa-undo'}
                            ) }}
                            
                            {{ operations_card(
                                title='자산 폐기 관리',
                                description='자산의 폐기 신청, 승인, 처리 관리',
                                icon='fa-trash-alt',
                                color='danger',
                                actions=[
                                    {'label': '폐기 현황', 'url': url_for('operations.disposal_index')},
                                    {'label': '폐기 신청/등록', 'url': url_for('operations.disposal_form')}
                                ],
                                primary_action={'label': '폐기 신청', 'url': url_for('operations.disposal_form'), 'icon': 'fa-trash-alt'}
                            ) }}
                            
                            {{ operations_card(
                                title='자산 지급 관리',
                                description='자산의 지급 요청, 승인, 관리 및 다중 유형 지원',
                                icon='fa-hand-holding',
                                color='warning',
                                actions=[
                                    {'label': '지급 현황', 'url': url_for('operations.allocation_management')}
                                ],
                                primary_action={'label': '지급 요청', 'url': url_for('operations.allocation_management'), 'icon': 'fa-hand-holding'}
                            ) }}
                            
                            {{ operations_card(
                                title='자산 처분 계획',
                                description='자산의 매각, 기부, 이전, 폐기 등 처분 계획 수립 및 관리',
                                icon='fa-calendar-alt',
                                color='info',
                                actions=[
                                    {'label': '처분 계획 현황', 'url': url_for('operations.disposal_planning')}
                                ],
                                primary_action={'label': '계획 수립', 'url': url_for('operations.disposal_planning'), 'icon': 'fa-calendar-alt'}
                            ) }}
                            
                            {{ operations_card(
                                title='폐기 계획 및 승인',
                                description='폐기 요청부터 다단계 승인까지 체계적 관리',
                                icon='fa-clipboard-list',
                                color='warning',
                                actions=[
                                    {'label': '폐기 계획 현황', 'url': url_for('operations.asset_disposal_planning')}
                                ],
                                primary_action={'label': '계획 수립', 'url': url_for('operations.asset_disposal_planning'), 'icon': 'fa-clipboard-list'}
                            ) }}
                        </div>
                    </div>
                </div>
            </div>

            <!-- 고급 운영 기능 -->
            <div class="content-section">
                <div class="content-section__header">
                    <h3 class="content-section__title">고급 운영 기능</h3>
                </div>
                <div class="content-section__body">
                    <div class="quick-actions">
                        <div class="quick-actions__grid">
                            {{ operations_card(
                                title='업그레이드/교체 관리',
                                description='자산 업그레이드 및 교체 계획 수립 및 관리',
                                icon='fa-sync-alt',
                                color='info',
                                actions=[
                                    {'label': '업그레이드 계획 현황', 'url': url_for('operations.upgrade_management')}
                                ],
                                primary_action={'label': '업그레이드 관리', 'url': url_for('operations.upgrade_management'), 'icon': 'fa-sync-alt'}
                            ) }}
                            
                            {{ operations_card(
                                title='생명주기 추적',
                                description='자산의 전체 생명주기 이벤트 추적 및 분석',
                                icon='fa-history',
                                color='success',
                                actions=[
                                    {'label': '생명주기 이벤트 현황', 'url': url_for('operations.lifecycle_tracking')}
                                ],
                                primary_action={'label': '생명주기 추적', 'url': url_for('operations.lifecycle_tracking'), 'icon': 'fa-history'}
                            ) }}
                            
                            {{ operations_card(
                                title='자산 이력 조회',
                                description='자산별 대여/반납/폐기 등 모든 운영 이력을 종합적으로 조회',
                                icon='fa-search',
                                color='info',
                                actions=[],
                                primary_action={'label': '이력 조회하기', 'url': url_for('operations.history'), 'icon': 'fa-history'}
                            ) }}
                            
                            {{ operations_card(
                                title='운영 통계 및 보고서',
                                description='자산 운영 관련 통계 및 보고서를 생성하고 다운로드',
                                icon='fa-chart-bar',
                                color='secondary',
                                actions=[
                                    {'label': 'Excel 다운로드', 'url': '#'},
                                    {'label': 'PDF 다운로드', 'url': '#'},
                                    {'label': '매월 자동 보고서 설정', 'url': '#'}
                                ],
                                primary_action={'label': '통계 및 보고서', 'url': url_for('operations.statistics'), 'icon': 'fa-chart-bar'}
                            ) }}
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- 사이드바 - 세부 워크플로우 -->
        <div class="dashboard-layout__sidebar">
            <!-- 반납 워크플로우 -->
            <div class="content-section">
                <div class="content-section__header">
                    <h3 class="content-section__title">반납 워크플로우</h3>
                </div>
                <div class="content-section__body">
                    <div class="list-item">
                        <div class="list-item__content">
                            <div class="list-item__title">승인 워크플로우</div>
                            <div class="list-item__subtitle">다단계 승인 시스템으로 반납 요청을 체계적으로 관리</div>
                        </div>
                        <div class="list-item__actions">
                            {{ btn('보기', variant='text', size='sm', url=url_for('operations.return_approval_workflow')) }}
                        </div>
                    </div>
                    
                    <div class="list-item">
                        <div class="list-item__content">
                            <div class="list-item__title">상태 추적 시스템</div>
                            <div class="list-item__subtitle">실시간 반납 진행 상황 모니터링 및 통계</div>
                        </div>
                        <div class="list-item__actions">
                            {{ btn('보기', variant='text', size='sm', url=url_for('operations.return_status_tracking')) }}
                        </div>
                    </div>
                    
                    <div class="list-item">
                        <div class="list-item__content">
                            <div class="list-item__title">알림 관리</div>
                            <div class="list-item__subtitle">자동 알림 및 리마인더 시스템 관리</div>
                        </div>
                        <div class="list-item__actions">
                            {{ btn('보기', variant='text', size='sm', url=url_for('operations.return_notifications')) }}
                        </div>
                    </div>
                </div>
            </div>

            <!-- 빠른 액션 -->
            <div class="content-section">
                <div class="content-section__header">
                    <h3 class="content-section__title">빠른 액션</h3>
                </div>
                <div class="content-section__body">
                    <div class="quick-actions__list">
                        {{ btn('새 대여 등록', variant='primary', size='sm', icon='fa-plus', url=url_for('operations.loan_form'), block=true) }}
                        {{ btn('반납 처리', variant='success', size='sm', icon='fa-undo', url=url_for('operations.return_form'), block=true) }}
                        {{ btn('폐기 신청', variant='danger', size='sm', icon='fa-trash-alt', url=url_for('operations.disposal_form'), block=true) }}
                        {{ btn('이력 조회', variant='info', size='sm', icon='fa-search', url=url_for('operations.history'), block=true) }}
                    </div>
                </div>
            </div>

            <!-- 운영 현황 요약 -->
            <div class="content-section">
                <div class="content-section__header">
                    <h3 class="content-section__title">운영 현황 요약</h3>
                </div>
                <div class="content-section__body">
                    <div class="summary-stats">
                        <div class="summary-stat">
                            <div class="summary-stat__label">이번주 대여</div>
                            <div class="summary-stat__value">12건</div>
                        </div>
                        <div class="summary-stat">
                            <div class="summary-stat__label">이번주 반납</div>
                            <div class="summary-stat__value">8건</div>
                        </div>
                        <div class="summary-stat">
                            <div class="summary-stat__label">평균 대여기간</div>
                            <div class="summary-stat__value">15일</div>
                        </div>
                        <div class="summary-stat">
                            <div class="summary-stat__label">활용률</div>
                            <div class="summary-stat__value">78%</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block styles %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/pages/operations/index.new.css') }}">
{% endblock %}

{% block scripts %}
<script src="{{ url_for('static', filename='js/shared/operations/operations-utils.js') }}"></script>
<script src="{{ url_for('static', filename='js/shared/operations/notification-utils.js') }}"></script>
<script src="{{ url_for('static', filename='js/shared/operations/api-utils.js') }}"></script>
<script src="{{ url_for('static', filename='js/pages/operations/index.js') }}"></script>
{% endblock %}