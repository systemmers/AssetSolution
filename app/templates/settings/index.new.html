{% extends "base.html" %}

{% block title %}시스템 설정 - 자산관리 시스템{% endblock %}

{% block page_header %}
<div class="page__header">
    <div>
        <h2 class="page__title">시스템 설정</h2>
        <p class="page__subtitle">시스템 환경 및 관리 기능 설정</p>
    </div>
</div>
{% endblock %}

{% block content %}
<!-- 새로운 매크로 시스템 사용 -->
{% from 'macros/forms.html' import form_group, form_input, form_select, form_checkbox, form_switch, form_textarea %}
{% from 'macros/buttons.html' import btn %}
{% from 'macros/cards.html' import info_card, data_card %}

<div class="settings-layout">
    <!-- 사이드바 네비게이션 -->
    <div class="settings-layout__sidebar">
        <div class="content-section">
            <div class="content-section__header">
                <h3 class="content-section__title">설정 카테고리</h3>
            </div>
            <div class="content-section__body content-section--flush">
                <nav class="settings-nav">
                    <div class="settings-nav__group">
                        <a href="#general" class="settings-nav__item settings-nav__item--active" data-tab="general">
                            <i class="fas fa-cog"></i>
                            <span>일반 설정</span>
                        </a>
                        <a href="#assetcodes" class="settings-nav__item" data-tab="assetcodes">
                            <i class="fas fa-barcode"></i>
                            <span>자산번호 설정</span>
                        </a>
                        <a href="#categories" class="settings-nav__item" data-tab="categories">
                            <i class="fas fa-tags"></i>
                            <span>카테고리 관리</span>
                        </a>
                        <a href="#departments" class="settings-nav__item" data-tab="departments">
                            <i class="fas fa-sitemap"></i>
                            <span>부서 관리</span>
                        </a>
                        <a href="#locations" class="settings-nav__item" data-tab="locations">
                            <i class="fas fa-map-marker-alt"></i>
                            <span>위치 관리</span>
                        </a>
                        <a href="#fields" class="settings-nav__item" data-tab="fields">
                            <i class="fas fa-list-alt"></i>
                            <span>사용자 정의 필드</span>
                        </a>
                    </div>
                    
                    <div class="settings-nav__group">
                        <div class="settings-nav__group-label">시스템 관리</div>
                        <a href="#backup" class="settings-nav__item" data-tab="backup">
                            <i class="fas fa-database"></i>
                            <span>백업 및 복원</span>
                        </a>
                        <a href="#ai" class="settings-nav__item" data-tab="ai">
                            <i class="fas fa-robot"></i>
                            <span>AI 서비스 설정</span>
                        </a>
                    </div>
                    
                    <div class="settings-nav__group">
                        <div class="settings-nav__group-label">개발 도구</div>
                        <a href="{{ url_for('demo.style_guide') }}" class="settings-nav__item settings-nav__item--external" target="_blank">
                            <i class="fas fa-palette"></i>
                            <span>스타일 가이드</span>
                            <i class="fas fa-external-link-alt"></i>
                        </a>
                    </div>
                </nav>
            </div>
        </div>
    </div>

    <!-- 메인 콘텐츠 -->
    <div class="settings-layout__main">
        <!-- 일반 설정 -->
        <div class="settings-tab settings-tab--active" id="general-tab">
            <div class="content-section">
                <div class="content-section__header">
                    <h3 class="content-section__title">일반 설정</h3>
                    <div class="content-section__actions">
                        {{ btn('설정 저장', variant='primary', icon='fa-save', id='saveGeneralSettings') }}
                    </div>
                </div>
                <div class="content-section__body">
                    <form id="generalSettingsForm" class="settings-form">
                        <div class="settings-form__section">
                            <h4 class="settings-form__section-title">기본 정보</h4>
                            <div class="settings-form__grid">
                                {{ form_group(
                                    label='시스템 이름',
                                    control=form_input(
                                        name='systemName',
                                        value='자산관리 시스템',
                                        placeholder='시스템 이름을 입력하세요',
                                        id='systemName'
                                    ),
                                    help='시스템 전체에서 표시될 이름입니다.'
                                ) }}
                                
                                {{ form_group(
                                    label='회사명',
                                    control=form_input(
                                        name='companyName',
                                        value='(주)예시회사',
                                        placeholder='회사명을 입력하세요',
                                        id='companyName'
                                    )
                                ) }}
                            </div>
                            
                            {{ form_group(
                                label='로고 이미지',
                                control=form_input(
                                    type='file',
                                    name='logoFile',
                                    accept='image/png,image/jpeg',
                                    id='logoFile'
                                ),
                                help='최대 2MB, PNG 또는 JPG 파일'
                            ) }}
                        </div>

                        <div class="settings-form__section">
                            <h4 class="settings-form__section-title">지역화 설정</h4>
                            <div class="settings-form__grid">
                                {{ form_group(
                                    label='날짜 형식',
                                    control=form_select(
                                        name='dateFormat',
                                        options=[
                                            {'value': 'YYYY-MM-DD', 'label': 'YYYY-MM-DD'},
                                            {'value': 'DD/MM/YYYY', 'label': 'DD/MM/YYYY'},
                                            {'value': 'MM/DD/YYYY', 'label': 'MM/DD/YYYY'}
                                        ],
                                        selected='YYYY-MM-DD',
                                        id='dateFormat'
                                    )
                                ) }}
                                
                                {{ form_group(
                                    label='통화 형식',
                                    control=form_select(
                                        name='currencyFormat',
                                        options=[
                                            {'value': 'KRW', 'label': '대한민국 원화 (₩)'},
                                            {'value': 'USD', 'label': '미국 달러 ($)'},
                                            {'value': 'EUR', 'label': '유로 (€)'},
                                            {'value': 'JPY', 'label': '일본 엔 (¥)'}
                                        ],
                                        selected='KRW',
                                        id='currencyFormat'
                                    )
                                ) }}
                            </div>
                        </div>

                        <div class="settings-form__section">
                            <h4 class="settings-form__section-title">알림 설정</h4>
                            {{ form_switch(
                                name='enableNotifications',
                                label='이메일 알림 사용',
                                checked=true,
                                id='enableNotifications'
                            ) }}
                        </div>
                    </form>
                </div>
            </div>
        </div>

        <!-- 자산번호 설정 -->
        <div class="settings-tab" id="assetcodes-tab">
            <div class="content-section">
                <div class="content-section__header">
                    <h3 class="content-section__title">자산번호 설정</h3>
                    <div class="content-section__actions">
                        {{ btn('설정 저장', variant='primary', icon='fa-save') }}
                    </div>
                </div>
                <div class="content-section__body">
                    <form class="settings-form">
                        <div class="settings-form__section">
                            <h4 class="settings-form__section-title">자산번호 형식</h4>
                            
                            <div class="radio-group">
                                {{ form_group(
                                    label='',
                                    control='
                                    <div class="radio-group__options">
                                        <div class="radio-group__option">
                                            <input type="radio" name="numberFormat" id="formatCustom" value="custom" checked class="radio-group__input">
                                            <label for="formatCustom" class="radio-group__label">
                                                <span class="radio-group__title">형식 지정</span>
                                                <span class="radio-group__description">사용자 정의 패턴으로 자산번호 생성</span>
                                            </label>
                                        </div>
                                        <div class="radio-group__option">
                                            <input type="radio" name="numberFormat" id="formatAutomatic" value="automatic" class="radio-group__input">
                                            <label for="formatAutomatic" class="radio-group__label">
                                                <span class="radio-group__title">자동 생성</span>
                                                <span class="radio-group__description">일련번호만 사용하는 간단한 형식</span>
                                            </label>
                                        </div>
                                    </div>
                                    '
                                ) }}
                            </div>

                            <div class="settings-form__grid">
                                {{ form_group(
                                    label='형식 패턴',
                                    control=form_input(
                                        name='customFormatPattern',
                                        value='ASSET-{YYYY}-{CAT}-{SEQ}',
                                        placeholder='예: ASSET-{YYYY}-{CAT}-{SEQ}',
                                        id='customFormatPattern'
                                    ),
                                    help='결과 예시: ASSET-2023-PC-0001'
                                ) }}
                                
                                {{ form_group(
                                    label='시작 번호',
                                    control=form_input(
                                        type='number',
                                        name='startingNumber',
                                        value='1',
                                        min='1',
                                        id='startingNumber'
                                    )
                                ) }}
                            </div>

                            <div class="settings-form__grid">
                                {{ form_group(
                                    label='일련번호 자릿수',
                                    control=form_select(
                                        name='seqDigits',
                                        options=[
                                            {'value': '4', 'label': '4자리 (0001)'},
                                            {'value': '5', 'label': '5자리 (00001)'},
                                            {'value': '6', 'label': '6자리 (000001)'},
                                            {'value': 'custom', 'label': '사용자 지정'}
                                        ],
                                        selected='4',
                                        id='seqDigits'
                                    )
                                ) }}
                            </div>

                            {{ form_switch(
                                name='resetSeqYearly',
                                label='매년 일련번호 초기화',
                                checked=true,
                                id='resetSeqYearly'
                            ) }}

                            <div class="alert alert-info">
                                <i class="fas fa-info-circle"></i>
                                자산번호 형식을 변경해도 기존 자산의 번호는 변경되지 않습니다.
                            </div>
                        </div>

                        <div class="settings-form__section">
                            <h4 class="settings-form__section-title">바코드/QR 설정</h4>
                            <div class="settings-form__grid">
                                {{ form_group(
                                    label='바코드 타입',
                                    control=form_select(
                                        name='barcodeType',
                                        options=[
                                            {'value': 'code128', 'label': 'Code 128 (권장)'},
                                            {'value': 'code39', 'label': 'Code 39'},
                                            {'value': 'ean13', 'label': 'EAN-13'},
                                            {'value': 'upc', 'label': 'UPC'}
                                        ],
                                        selected='code128',
                                        id='barcodeType'
                                    )
                                ) }}
                                
                                {{ form_group(
                                    label='QR 코드 정보',
                                    control=form_select(
                                        name='qrCodeContent',
                                        options=[
                                            {'value': 'assetcode', 'label': '자산번호만'},
                                            {'value': 'assetcode_url', 'label': '자산번호 + 상세 URL'},
                                            {'value': 'full', 'label': '전체 자산 정보'}
                                        ],
                                        selected='assetcode',
                                        id='qrCodeContent'
                                    )
                                ) }}
                            </div>

                            <div class="settings-form__switches">
                                {{ form_switch(
                                    name='generateLabelsAutomatically',
                                    label='자산 등록 시 라벨 자동 생성',
                                    checked=true,
                                    id='generateLabelsAutomatically'
                                ) }}
                                
                                {{ form_switch(
                                    name='showHumanReadableCode',
                                    label='바코드 아래 자산번호 표시',
                                    checked=true,
                                    id='showHumanReadableCode'
                                ) }}
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </div>

        <!-- 카테고리 관리 -->
        <div class="settings-tab" id="categories-tab">
            <div class="content-section">
                <div class="content-section__header">
                    <h3 class="content-section__title">카테고리 관리</h3>
                </div>
                <div class="content-section__body">
                    <div class="empty-state">
                        <div class="empty-state__icon">
                            <i class="fas fa-tags"></i>
                        </div>
                        <div class="empty-state__title">카테고리 관리</div>
                        <div class="empty-state__description">카테고리는 별도 페이지에서 관리됩니다.</div>
                        <div class="empty-state__action">
                            {{ btn('카테고리 관리 페이지로 이동', variant='primary', icon='fa-external-link-alt', url=url_for('settings.categories')) }}
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- 부서 관리 -->
        <div class="settings-tab" id="departments-tab">
            <div class="content-section">
                <div class="content-section__header">
                    <h3 class="content-section__title">부서 관리</h3>
                </div>
                <div class="content-section__body">
                    <div class="alert alert-info">
                        <i class="fas fa-info-circle"></i>
                        부서 관리 기능은 현재 개발중입니다.
                    </div>
                </div>
            </div>
        </div>

        <!-- 위치 관리 -->
        <div class="settings-tab" id="locations-tab">
            <div class="content-section">
                <div class="content-section__header">
                    <h3 class="content-section__title">위치 관리</h3>
                </div>
                <div class="content-section__body">
                    <div class="alert alert-info">
                        <i class="fas fa-info-circle"></i>
                        위치 관리 기능은 현재 개발중입니다.
                    </div>
                </div>
            </div>
        </div>

        <!-- 사용자 정의 필드 -->
        <div class="settings-tab" id="fields-tab">
            <div class="content-section">
                <div class="content-section__header">
                    <h3 class="content-section__title">사용자 정의 필드</h3>
                    <div class="content-section__actions">
                        {{ btn('새 필드 추가', variant='primary', icon='fa-plus', id='addCustomField') }}
                    </div>
                </div>
                <div class="content-section__body">
                    <div id="customFieldsContainer">
                        <div class="empty-state">
                            <div class="empty-state__icon">
                                <i class="fas fa-list-alt"></i>
                            </div>
                            <div class="empty-state__title">사용자 정의 필드가 없습니다</div>
                            <div class="empty-state__description">새 필드 추가 버튼을 클릭하여 사용자 정의 필드를 생성하세요.</div>
                        </div>
                    </div>

                    <div class="field-types-info">
                        <h4>지원하는 필드 타입</h4>
                        <div class="field-types-grid">
                            <div class="field-type">
                                <i class="fas fa-font"></i>
                                <span>텍스트 (단일 줄)</span>
                            </div>
                            <div class="field-type">
                                <i class="fas fa-align-left"></i>
                                <span>텍스트영역 (여러 줄)</span>
                            </div>
                            <div class="field-type">
                                <i class="fas fa-list"></i>
                                <span>선택목록 (드롭다운)</span>
                            </div>
                            <div class="field-type">
                                <i class="fas fa-check-square"></i>
                                <span>체크박스</span>
                            </div>
                            <div class="field-type">
                                <i class="fas fa-calendar"></i>
                                <span>날짜</span>
                            </div>
                            <div class="field-type">
                                <i class="fas fa-hashtag"></i>
                                <span>숫자</span>
                            </div>
                            <div class="field-type">
                                <i class="fas fa-link"></i>
                                <span>URL</span>
                            </div>
                            <div class="field-type">
                                <i class="fas fa-envelope"></i>
                                <span>이메일</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- 백업 및 복원 -->
        <div class="settings-tab" id="backup-tab">
            <div class="content-section">
                <div class="content-section__header">
                    <h3 class="content-section__title">백업 및 복원</h3>
                </div>
                <div class="content-section__body">
                    <div class="backup-grid">
                        <!-- 백업 생성 -->
                        <div class="backup-card">
                            <div class="backup-card__header">
                                <div class="backup-card__icon backup-card__icon--create">
                                    <i class="fas fa-download"></i>
                                </div>
                                <h4 class="backup-card__title">백업 생성</h4>
                            </div>
                            <div class="backup-card__body">
                                <p>선택한 데이터를 백업 파일로 생성합니다.</p>
                                
                                {{ form_switch(
                                    name='enableAutoBackup',
                                    label='자동 백업 활성화',
                                    id='enableAutoBackup'
                                ) }}
                                
                                <div class="backup-settings">
                                    {{ form_group(
                                        label='백업 주기',
                                        control=form_select(
                                            name='backupInterval',
                                            options=[
                                                {'value': 'daily', 'label': '매일'},
                                                {'value': 'weekly', 'label': '매주'},
                                                {'value': 'monthly', 'label': '매월'}
                                            ],
                                            selected='weekly',
                                            id='backupInterval'
                                        )
                                    ) }}
                                    
                                    {{ form_group(
                                        label='보관 기간 (일)',
                                        control=form_input(
                                            type='number',
                                            name='backupRetentionDays',
                                            value='30',
                                            min='1',
                                            max='365',
                                            id='backupRetentionDays'
                                        )
                                    ) }}
                                </div>
                            </div>
                            <div class="backup-card__footer">
                                {{ btn('새 백업 생성', variant='success', icon='fa-plus', id='createBackupBtn', block=true) }}
                            </div>
                        </div>

                        <!-- 복원 -->
                        <div class="backup-card">
                            <div class="backup-card__header">
                                <div class="backup-card__icon backup-card__icon--restore">
                                    <i class="fas fa-upload"></i>
                                </div>
                                <h4 class="backup-card__title">복원</h4>
                            </div>
                            <div class="backup-card__body">
                                <p>백업 파일에서 데이터를 복원합니다.</p>
                                
                                <div class="alert alert-warning">
                                    <i class="fas fa-exclamation-triangle"></i>
                                    <strong>주의:</strong> 복원 시 기존 데이터가 덮어쓰여집니다.
                                </div>
                                
                                <input type="file" id="restoreFileInput" accept=".json" class="form-control">
                            </div>
                            <div class="backup-card__footer">
                                {{ btn('파일 선택', variant='warning', icon='fa-file-upload', id='selectRestoreFile', block=true) }}
                            </div>
                        </div>
                    </div>

                    <!-- 백업 이력 -->
                    <div class="backup-history">
                        <h4>백업 이력</h4>
                        {{ data_card(
                            title='',
                            data_content='
                            <div class="table-responsive">
                                <table class="table table-hover">
                                    <thead>
                                        <tr>
                                            <th>생성일시</th>
                                            <th>백업 유형</th>
                                            <th>파일 크기</th>
                                            <th>상태</th>
                                            <th>액션</th>
                                        </tr>
                                    </thead>
                                    <tbody id="backupHistoryTable">
                                        <tr>
                                            <td colspan="5" class="text-center text-muted py-4">
                                                백업 이력을 로드하는 중...
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                            '
                        ) }}
                    </div>
                </div>
            </div>
        </div>

        <!-- AI 서비스 설정 -->
        <div class="settings-tab" id="ai-tab">
            <div class="content-section">
                <div class="content-section__header">
                    <h3 class="content-section__title">AI 서비스 설정</h3>
                    <div class="content-section__actions">
                        {{ btn('설정 저장', variant='primary', icon='fa-save') }}
                        {{ btn('연결 테스트', variant='outline-secondary', icon='fa-plug', id='testAiConnection') }}
                    </div>
                </div>
                <div class="content-section__body">
                    <form class="settings-form">
                        <div class="alert alert-info">
                            <i class="fas fa-info-circle"></i>
                            AI 서비스를 사용하려면 아래 설정을 구성하세요. API 키는 암호화되어 저장됩니다.
                        </div>

                        <div class="settings-form__section">
                            <h4 class="settings-form__section-title">기본 설정</h4>
                            
                            {{ form_switch(
                                name='enableAiServices',
                                label='AI 서비스 활성화',
                                help='자산 설명 생성, 자동 분류, 이상 탐지 등 AI 기능을 활성화합니다.',
                                id='enableAiServices'
                            ) }}

                            {{ form_group(
                                label='AI 모델',
                                control=form_select(
                                    name='aiModel',
                                    options=[
                                        {'value': '', 'label': '모델 선택', 'disabled': true},
                                        {'value': 'gpt-4o', 'label': 'GPT-4o', 'group': 'OpenAI'},
                                        {'value': 'gpt-4-turbo', 'label': 'GPT-4 Turbo', 'group': 'OpenAI'},
                                        {'value': 'claude-3-opus', 'label': 'Claude 3 Opus', 'group': 'Anthropic'},
                                        {'value': 'claude-3-sonnet', 'label': 'Claude 3 Sonnet', 'group': 'Anthropic'},
                                        {'value': 'hyper-clova-x', 'label': 'HyperCLOVA X', 'group': 'Naver'}
                                    ],
                                    id='aiModel'
                                ),
                                help='선택한 모델은 API 사용량 및 비용에 영향을 미칩니다.'
                            ) }}

                            {{ form_group(
                                label='API 키',
                                control='
                                <div class="input-group">
                                    <input type="password" class="form-control" name="apiKey" id="apiKey" placeholder="API 키를 입력하세요">
                                    <button class="btn btn-outline-secondary" type="button" id="toggleApiKey">
                                        <i class="fas fa-eye"></i>
                                    </button>
                                    <button class="btn btn-outline-primary" type="button" id="verifyApiKey">
                                        <i class="fas fa-check-circle"></i> 검증
                                    </button>
                                </div>
                                ',
                                help='API 키는 암호화되어 저장됩니다. 키가 노출되지 않도록 주의하세요.'
                            ) }}
                        </div>

                        <div class="settings-form__section">
                            <h4 class="settings-form__section-title">사용 용도</h4>
                            <div class="ai-features-grid">
                                {{ form_checkbox(
                                    name='useForAssetDescription',
                                    label='자산 설명 자동 생성',
                                    checked=true,
                                    id='useForAssetDescription'
                                ) }}
                                
                                {{ form_checkbox(
                                    name='useForCategorization',
                                    label='자동 카테고리 분류',
                                    checked=true,
                                    id='useForCategorization'
                                ) }}
                                
                                {{ form_checkbox(
                                    name='useForAnomalyDetection',
                                    label='이상 거래/사용 패턴 감지',
                                    id='useForAnomalyDetection'
                                ) }}
                                
                                {{ form_checkbox(
                                    name='useForPredictiveMaintenance',
                                    label='예측 정비 추천',
                                    id='useForPredictiveMaintenance'
                                ) }}
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block styles %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/pages/settings/index.new.css') }}">
{% endblock %}

{% block scripts %}
<script type="module" src="{{ url_for('static', filename='js/pages/settings/index.js') }}"></script>
{% endblock %}